{% extends "base.html" %}
{% block title %}Shopping cart{% endblock %}
{% block body_class %}cart-page{% endblock %}

{% block content %}
<div class="page-container">

    <h1 class="page-title">Shopping cart</h1>
    <p class="page-subtitle">Your selected products</p>

    <!-- Global cart total -->
    <p class="cart-summary">
        Shopping cart total: {{ total|eur }} €
    </p>

    <div class="divider"></div>

    {% if products %}

        <!-- ===================== CART TABLE WITH SCROLL ===================== -->
        <div class="table-scroll">      {# ← ДОДАНО ОБГОРТКУ #}

            <table class="product-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Category</th>
                        <th class="num">Price per piece</th>
                        <th class="num">Quantity</th>
                        <th class="num">Total</th>
                    </tr>
                </thead>

                <tbody>
                    {% for p in products %}
                    <tr id="row-{{ p.product_id }}">

                        <td>{{ p.product_id }}</td>
                        <td>{{ p.product }}</td>
                        <td>{{ p.category }}</td>

                        <!-- Unit price -->
                        <td class="num">{{ p.price|eur }} €</td>

                        <!-- Quantity with +/- buttons -->
                        <td class="num">
                            <form method="post"
                                  action="{{ url_for('orders.set_cart_quantity', product_id=p.product_id) }}"
                                  class="qty-form">

                                <input type="hidden"
                                       name="return_url"
                                       value="{{ request.full_path }}#row-{{ p.product_id }}">

                                <button type="button"
                                        class="qty-btn"
                                        onclick="changeQty(this, -1)">−
                                </button>

                                <input type="number"
                                       name="qty"
                                       min="0"
                                       max="999999"
                                       class="qty-input"
                                       value="{{ p.quantity }}">

                                <button type="button"
                                        class="qty-btn"
                                        onclick="changeQty(this, 1)">+
                                </button>
                            </form>
                        </td>

                        <!-- Line total -->
                        <td class="num">{{ p.line_total|eur }} €</td>

                    </tr>
                    {% endfor %}
                </tbody>

                <!-- TABLE FOOTER -->
                <tfoot>
                <tr>
                    <td colspan="5" class="cart-total num">
                        Total:
                    </td>
                    <td class="num cart-total">
                        {{ total|eur }} €
                    </td>
                </tr>
                </tfoot>
            </table>

        </div>   {# ← КІНЕЦЬ SCROLL WRAPPER #}

    {% else %}
        <p>Your cart is empty.</p>
    {% endif %}

    <!-- ===================== ACTION BUTTONS ===================== -->
    <div class="cart-actions">

        <a href="{{ url_for('products.product_list') }}" class="nav-link">
            Back to products
        </a>

        {% if products %}
            <form method="post" action="{{ url_for('orders.clear_cart') }}">
                <button type="submit" class="card-btn">
                    Empty shopping cart
                </button>
            </form>

            <form method="get" action="{{ url_for('orders.checkout') }}">
                <button type="submit" class="card-btn">
                    To the checkout
                </button>
            </form>
        {% endif %}
    </div>

</div>
{% endblock %}
