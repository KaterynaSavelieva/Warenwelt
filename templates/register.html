{% extends "base.html" %}
{% block title %}Register{% endblock %}

{% block content %}
<div class="page-container">

  <h1 class="page-title">Register</h1>
  <p class="page-subtitle">
    Create a new customer account for the online shop.
  </p>

  <div class="divider"></div>

  {# —è–∫—â–æ —Ç–∏ –∑ –±–µ–∫—É –ø–µ—Ä–µ–¥–∞—î—à –∑–º—ñ–Ω–Ω—É error –∞–±–æ errors ‚Äì –º–æ–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç–∏ —Ç—É—Ç #}
  {% if error %}
    <div style="
        margin-bottom:16px;
        padding:10px 14px;
        border-radius:8px;
        background-color:#fee2e2;
        color:#7f1d1d;
        font-size:14px;">
      {{ error }}
    </div>
  {% endif %}

  <form method="post" autocomplete="off"
        style="background:#ffffff; padding:20px 24px; border-radius:10px;
               box-shadow:0 4px 16px rgba(0,0,0,0.08); max-width:520px;">

    <p>
      <label>Name:</label><br>
      <input type="text" name="name"
             value="{{ form.name or '' }}" required
             style="width:100%; padding:6px 8px; border-radius:6px; border:1px solid #d1d5db;">
    </p>

    <p>
      <label>Email:</label><br>
      <input type="email" name="email"
             value="{{ form.email or '' }}" required
             style="width:100%; padding:6px 8px; border-radius:6px; border:1px solid #d1d5db;">
    </p>

    <p>
      <label>Address (optional):</label><br>
      <input type="text" name="address"
             value="{{ form.address or '' }}"
             style="width:100%; padding:6px 8px; border-radius:6px; border:1px solid #d1d5db;">
    </p>

    <p>
      <label>Phone (optional):</label><br>
      <input type="tel" name="phone"
             value="{{ form.phone or '' }}"
             style="width:100%; padding:6px 8px; border-radius:6px; border:1px solid #d1d5db;">
    </p>

    <p>
      <label>Kind:</label><br>
      <select name="kind" id="kind-select"
              style="width:100%; padding:6px 8px; border-radius:6px; border:1px solid #d1d5db;">
        <option value="private" {% if form.kind =='private' %}selected{% endif %}>Private</option>
        <option value="company" {% if form.kind =='company' %}selected{% endif %}>Company</option>
      </select>
    </p>

    <p>
      <label>Password:</label><br>
      <span class="password-wrapper">
        <input type="password" name="password" id="password"
               required autocomplete="off"
               style="padding:6px 8px; border-radius:6px; border:1px solid #d1d5db;">
        <button type="button" id="toggle-password" class="eye-btn" aria-label="Show password">üëÅ</button>
      </span>
    </p>

    <p>
      <label>Repeat password:</label><br>
      <span class="password-wrapper">
        <input type="password" name="password2" id="password2"
               required autocomplete="off"
               style="padding:6px 8px; border-radius:6px; border:1px solid #d1d5db;">
        <button type="button" id="toggle-password2" class="eye-btn" aria-label="Show password">üëÅ</button>
      </span>
    </p>

    <p id="birthdate-group">
      <label>Birthdate (for private customers):</label><br>
      <input type="date" name="birthdate" id="birthdate"
             style="padding:6px 8px; border-radius:6px; border:1px solid #d1d5db;">
    </p>

    <p id="company-group">
      <label>Company number (for company customers):</label><br>
      <input type="text" name="company_number"
             style="padding:6px 8px; border-radius:6px; border:1px solid #d1d5db;">
    </p>

    <p style="margin-top:18px;">
      <button type="submit" class="card-btn">
        Register
      </button>
    </p>
  </form>
</div>

<style>
  .password-wrapper {
    display: inline-flex;
    align-items: center;
  }
  .password-wrapper input {
    margin-right: 4px;
  }
  .eye-btn {
    border: 1px solid #ccc;
    padding: 2px 6px;
    cursor: pointer;
    background: #f7f7f7;
  }
</style>

<script>
  // –ü–æ–∫–∞–∑/–ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –±–ª–æ–∫—ñ–≤ Privat/Company
  function updateKindFields() {
    const kind = document.getElementById("kind-select").value;
    const birth = document.getElementById("birthdate-group");
    const company = document.getElementById("company-group");

    if (kind === "private") {
      birth.style.display = "block";
      company.style.display = "none";
    } else {
      birth.style.display = "none";
      company.style.display = "block";
    }
  }

  document.addEventListener("DOMContentLoaded", function () {
    const select = document.getElementById("kind-select");
    if (select) {
      select.addEventListener("change", updateKindFields);
      updateKindFields();
    }

    function setupEye(inputId, btnId) {
      const input = document.getElementById(inputId);
      const btn = document.getElementById(btnId);
      if (!input || !btn) return;

      const show = () => { input.type = "text"; };
      const hide = () => { input.type = "password"; };

      btn.addEventListener("mousedown", show);
      btn.addEventListener("mouseup", hide);
      btn.addEventListener("mouseleave", hide);
      btn.addEventListener("touchstart", function (e) {
        e.preventDefault();
        show();
      });
      btn.addEventListener("touchend", function (e) {
        e.preventDefault();
        hide();
      });
    }

    setupEye("password", "toggle-password");
    setupEye("password2", "toggle-password2");

    // max-–¥–∞—Ç–∞ –¥–ª—è birthdate (—Å—å–æ–≥–æ–¥–Ω—ñ –º—ñ–Ω—É—Å 18 —Ä–æ–∫—ñ–≤)
    const bdInput = document.getElementById("birthdate");
    if (bdInput) {
      const today = new Date();
      const year = today.getFullYear() - 18;
      const month = String(today.getMonth() + 1).padStart(2, "0");
      const day = String(today.getDate()).padStart(2, "0");
      const maxDate = `${year}-${month}-${day}`;
      bdInput.setAttribute("max", maxDate);
    }
  });
</script>

{% endblock %}
